<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Landmark Project - Singapore</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>

    <script src="Scripts/cannon.js"></script>

    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>

<body>
    <canvas id="renderCanvas"></canvas>

    <script>
        const canvas = document.getElementById('renderCanvas');
        const engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true });

        const createScene = function () {
            // Create a basic BJS Scene object
            var scene = new BABYLON.Scene(engine);
            // Create a FreeCamera, and set its position to {x: 0, y: 5, z: -10}
            var camera = new BABYLON.FreeCamera('camera1', new BABYLON.Vector3(0, 5, -10), scene);
            // Target the camera to scene origin
            camera.setTarget(BABYLON.Vector3.Zero());
            // Attach the camera to the canvas
            camera.attachControl(canvas, false);
            //move the camera to 0,0,4
            camera.position.x = 0;
            camera.position.y = 4;
            camera.position.z = 0;
            camera.ellipsoid
            camera.checkCollisions = true;
            camera.applyGravity = true
            // Create a basic light, aiming 0, 1, 0 - meaning, to the sky
            var light = new BABYLON.HemisphericLight('light1', new BABYLON.Vector3(0, 1, 0), scene);
            // Create a built-in "sphere" shape; its constructor takes 6 params: name, segment, diameter, scene, updatable, sideOrientation
            //var sphere = BABYLON.Mesh.CreateSphere('sphere1', 16, 2, scene, false, BABYLON.Mesh.FRONTSIDE);
            // Move the sphere upward 1/2 of its height
            //sphere.position.y = 1;
            // Create a built-in "ground" shape; its constructor takes 6 params : name, width, height, subdivision, scene, updatable
            //var ground = BABYLON.Mesh.CreateGround('ground1', 6, 6, 2, scene, false);
            // Return the created scene
            return scene;
        }


        const scene = createScene();

        //load the things
        BABYLON.SceneLoader.Append("https://raw.githubusercontent.com/balupg/balupg.github.io/master/Content/", "Flats1.glb", scene, function (scene) {

            //first remove all duplicate material assignments by replacing them with the base material
            scene.meshes.forEach(function (m) {
                if (m.material) {
                    let matlID = m.material.id;
                    if (matlID.includes(".")) {
                        m.material = scene.getMaterialByID(matlID.split(".")[0]);
                    }
                }
            });
            //now go through all materials and dispose unused ones
            for (var mt=0; mt < scene.materials.length; mt++)
            {
                let mtl = scene.materials[mt];
                if (mtl.getBindedMeshes().length == 0) {
                    mtl.dispose();
                    mt--;
                }
            }
            scene.meshes.forEach(function (m) {
                m.checkCollisions = true;
            });
        });

        engine.runRenderLoop(function () {
            scene.render();
        });

        window.addEventListener('resize', function () {
            engine.resize();
        });

    </script>
</body>

</html>